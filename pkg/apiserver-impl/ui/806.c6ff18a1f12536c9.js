"use strict";(self.webpackChunkdevfile_builder=self.webpackChunkdevfile_builder||[]).push([[806],{5806:(ht,v,l)=>{l.r(v),l.d(v,{diagram:()=>At});var d=l(2911),J=l(8814),P=l(5703),i=l(855),Q=l(5963),X=l(1775),Z=l(9111);l(2735),l(1764),l(9006),l(7416),l(6780);const C="rect",R="rectWithTitle",T="statediagram",ot=`${T}-state`,$="transition",ct=`${$} note-edge`,it=`${T}-note`,lt=`${T}-cluster`,rt=`${T}-cluster-alt`,B="parent",G="note",dt="state",O="----",_t=`${O}${G}`,N=`${O}${B}`,U="fill:none",W="fill: #333",K="text",H="normal";let p={},E=0;function M(t="",n=0,s="",c=O){return`${dt}-${t}${null!==s&&s.length>0?`${c}${s}`:""}-${n}`}const f=(t,n,s,c,r,_)=>{const e=s.id,h=function St(t){return null==t?"":t.classes?t.classes.join(" "):""}(c[e]);if("root"!==e){let A=C;!0===s.start&&(A="start"),!1===s.start&&(A="end"),s.type!==d.a&&(A=s.type),p[e]||(p[e]={id:e,shape:A,description:i.d.sanitizeText(e,(0,i.g)()),classes:`${h} ${ot}`});const o=p[e];s.description&&(Array.isArray(o.description)?(o.shape=R,o.description.push(s.description)):o.description.length>0?(o.shape=R,o.description=o.description===e?[s.description]:[o.description,s.description]):(o.shape=C,o.description=s.description),o.description=i.d.sanitizeTextOrArray(o.description,(0,i.g)())),1===o.description.length&&o.shape===R&&(o.shape=C),!o.type&&s.doc&&(i.l.info("Setting cluster for ",e,x(s)),o.type="group",o.dir=x(s),o.shape=s.type===d.b?"divider":"roundedWithTitle",o.classes=o.classes+" "+lt+" "+(_?rt:""));const u={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:e,dir:o.dir,domId:M(e,E),type:o.type,padding:15};if(s.note){const S={labelStyle:"",shape:"note",labelText:s.note.text,classes:it,style:"",id:e+_t+"-"+E,domId:M(e,E,G),type:o.type,padding:15},y={labelStyle:"",shape:"noteGroup",labelText:s.note.text,classes:o.classes,style:"",id:e+N,domId:M(e,E,B),type:"group",padding:0};E++;const a=e+N;t.setNode(a,y),t.setNode(S.id,S),t.setNode(e,u),t.setParent(e,a),t.setParent(S.id,a);let g=e,D=S.id;"left of"===s.note.position&&(g=S.id,D=e),t.setEdge(g,D,{arrowhead:"none",arrowType:"",style:U,labelStyle:"",classes:ct,arrowheadStyle:W,labelpos:"c",labelType:K,thickness:H})}else t.setNode(e,u)}n&&"root"!==n.id&&(i.l.trace("Setting node ",e," to be child of its parent ",n.id),t.setParent(e,n.id)),s.doc&&(i.l.trace("Adding nodes children "),Dt(t,s,s.doc,c,r,!_))},Dt=(t,n,s,c,r,_)=>{i.l.trace("items",s),s.forEach(e=>{switch(e.stmt){case d.c:case d.a:f(t,n,e,c,r,_);break;case d.S:{f(t,n,e.state1,c,r,_),f(t,n,e.state2,c,r,_);const h={id:"edge"+E,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:U,labelStyle:"",label:i.d.sanitizeText(e.description,(0,i.g)()),arrowheadStyle:W,labelpos:"c",labelType:K,thickness:H,classes:$};t.setEdge(e.state1.id,e.state2.id,h,E),E++}}})},x=(t,n=d.e)=>{let s=n;if(t.doc)for(let c=0;c<t.doc.length;c++){const r=t.doc[c];"dir"===r.stmt&&(s=r.value)}return s},At={parser:d.p,db:d.d,renderer:{setConf:function(t){const n=Object.keys(t);for(const s of n);},getClasses:function(t,n){i.l.trace("Extracting classes"),n.db.clear();try{return n.parser.parse(t),n.db.extract(n.db.getRootDocV2()),n.db.getClasses()}catch(s){return s}},draw:function(t,n,s,c){i.l.info("Drawing state diagram (v2)",n),p={};let r=c.db.getDirection();void 0===r&&(r=d.D);const{securityLevel:_,state:e}=(0,i.g)(),h=e.nodeSpacing||50,A=e.rankSpacing||50;i.l.info(c.db.getRootDocV2()),c.db.extract(c.db.getRootDocV2()),i.l.info(c.db.getRootDocV2());const o=c.db.getStates(),u=new J.k({multigraph:!0,compound:!0}).setGraph({rankdir:x(c.db.getRootDocV2()),nodesep:h,ranksep:A,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});let S;f(u,void 0,c.db.getRootDocV2(),o,c.db,!0),"sandbox"===_&&(S=(0,P.Ys)("#i"+n));const y=(0,P.Ys)("sandbox"===_?S.nodes()[0].contentDocument.body:"body"),a=y.select(`[id="${n}"]`),g=y.select("#"+n+" g");(0,Q.r)(g,u,["barb"],T,n),Z.u.insertTitle(a,"statediagramTitleText",e.titleTopMargin,c.db.getDiagramTitle());const j=a.node().getBBox(),V=j.width+16,k=j.height+16;a.attr("class",T);const Y=a.node().getBBox();(0,X.c)(a,k,V,e.useMaxWidth);const z=`${Y.x-8} ${Y.y-8} ${V} ${k}`;i.l.debug(`viewBox ${z}`),a.attr("viewBox",z);const ft=document.querySelectorAll('[id="'+n+'"] .edgeLabel .label');for(const L of ft){const I=L.getBBox(),b=document.createElementNS("http://www.w3.org/2000/svg",C);b.setAttribute("rx",0),b.setAttribute("ry",0),b.setAttribute("width",I.width),b.setAttribute("height",I.height),L.insertBefore(b,L.firstChild)}}},styles:d.s,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,d.d.clear()}}}}]);