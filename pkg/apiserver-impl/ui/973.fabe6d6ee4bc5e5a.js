"use strict";(self.webpackChunkdevfile_builder=self.webpackChunkdevfile_builder||[]).push([[973],{6973:(nt,O,_)=>{_.r(O),_.d(O,{diagram:()=>it});var m=_(2911),S=_(5703),W=_(9006),T=_(8814),t=_(855),v=_(9111),z=_(1775);_(2735),_(1764),_(6780);const k={},Y=(e,i,r)=>{const o=(0,t.g)().state.padding,s=2*(0,t.g)().state.padding,l=e.node().getBBox(),p=l.width,a=l.x,d=e.append("text").attr("x",0).attr("y",(0,t.g)().state.titleShift).attr("font-size",(0,t.g)().state.fontSize).attr("class","state-title").text(i.id),x=d.node().getBBox().width+s;let g,c=Math.max(x,p);c===p&&(c+=s);const E=e.node().getBBox();g=a-o,x>p&&(g=(p-c)/2+o),Math.abs(a-E.x)<o&&x>p&&(g=a-(x-p)/2);const f=1-(0,t.g)().state.textHeight;return e.insert("rect",":first-child").attr("x",g).attr("y",f).attr("class",r?"alt-composit":"composit").attr("width",c).attr("height",E.height+(0,t.g)().state.textHeight+(0,t.g)().state.titleShift+1).attr("rx","0"),d.attr("x",g+o),x<=p&&d.attr("x",a+(c-s)/2-x/2+o),e.insert("rect",":first-child").attr("x",g).attr("y",(0,t.g)().state.titleShift-(0,t.g)().state.textHeight-(0,t.g)().state.padding).attr("width",c).attr("height",3*(0,t.g)().state.textHeight).attr("rx",(0,t.g)().state.radius),e.insert("rect",":first-child").attr("x",g).attr("y",(0,t.g)().state.titleShift-(0,t.g)().state.textHeight-(0,t.g)().state.padding).attr("width",c).attr("height",E.height+3+2*(0,t.g)().state.textHeight).attr("rx",(0,t.g)().state.radius),e},C=function(e,i){const r=i.id,o={id:r,label:i.id,width:0,height:0},s=e.append("g").attr("id",r).attr("class","stateGroup");"start"===i.type&&(e=>{e.append("circle").attr("class","start-state").attr("r",(0,t.g)().state.sizeUnit).attr("cx",(0,t.g)().state.padding+(0,t.g)().state.sizeUnit).attr("cy",(0,t.g)().state.padding+(0,t.g)().state.sizeUnit)})(s),"end"===i.type&&(e=>{e.append("circle").attr("class","end-state-outer").attr("r",(0,t.g)().state.sizeUnit+(0,t.g)().state.miniPadding).attr("cx",(0,t.g)().state.padding+(0,t.g)().state.sizeUnit+(0,t.g)().state.miniPadding).attr("cy",(0,t.g)().state.padding+(0,t.g)().state.sizeUnit+(0,t.g)().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",(0,t.g)().state.sizeUnit).attr("cx",(0,t.g)().state.padding+(0,t.g)().state.sizeUnit+2).attr("cy",(0,t.g)().state.padding+(0,t.g)().state.sizeUnit+2)})(s),("fork"===i.type||"join"===i.type)&&((e,i)=>{let r=(0,t.g)().state.forkWidth,o=(0,t.g)().state.forkHeight;if(i.parentId){let s=r;r=o,o=s}e.append("rect").style("stroke","black").style("fill","black").attr("width",r).attr("height",o).attr("x",(0,t.g)().state.padding).attr("y",(0,t.g)().state.padding)})(s,i),"note"===i.type&&((e,i)=>{i.attr("class","state-note");const r=i.append("rect").attr("x",0).attr("y",(0,t.g)().state.padding),o=i.append("g"),{textWidth:s,textHeight:l}=((e,i,r,o)=>{let s=0;const l=o.append("text");l.style("text-anchor","start"),l.attr("class","noteText");let p=e.replace(/\r\n/g,"<br/>");p=p.replace(/\n/g,"<br/>");const a=p.split(t.d.lineBreakRegex);let d=1.25*(0,t.g)().state.noteMargin;for(const B of a){const x=B.trim();if(x.length>0){const c=l.append("tspan");c.text(x),0===d&&(d+=c.node().getBBox().height),s+=d,c.attr("x",0+(0,t.g)().state.noteMargin),c.attr("y",0+s+1.25*(0,t.g)().state.noteMargin)}}return{textWidth:l.node().getBBox().width,textHeight:s}})(e,0,0,o);r.attr("height",l+2*(0,t.g)().state.noteMargin),r.attr("width",s+2*(0,t.g)().state.noteMargin)})(i.note.text,s),"divider"===i.type&&(e=>{e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",(0,t.g)().state.textHeight).attr("class","divider").attr("x2",2*(0,t.g)().state.textHeight).attr("y1",0).attr("y2",0)})(s),"default"===i.type&&0===i.descriptions.length&&((e,i)=>{const o=e.append("text").attr("x",2*(0,t.g)().state.padding).attr("y",(0,t.g)().state.textHeight+2*(0,t.g)().state.padding).attr("font-size",(0,t.g)().state.fontSize).attr("class","state-title").text(i.id).node().getBBox();e.insert("rect",":first-child").attr("x",(0,t.g)().state.padding).attr("y",(0,t.g)().state.padding).attr("width",o.width+2*(0,t.g)().state.padding).attr("height",o.height+2*(0,t.g)().state.padding).attr("rx",(0,t.g)().state.radius)})(s,i),"default"===i.type&&i.descriptions.length>0&&((e,i)=>{const s=e.append("text").attr("x",2*(0,t.g)().state.padding).attr("y",(0,t.g)().state.textHeight+1.3*(0,t.g)().state.padding).attr("font-size",(0,t.g)().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),l=s.height,p=e.append("text").attr("x",(0,t.g)().state.padding).attr("y",l+.4*(0,t.g)().state.padding+(0,t.g)().state.dividerMargin+(0,t.g)().state.textHeight).attr("class","state-description");let a=!0,d=!0;i.descriptions.forEach(function(g){a||(function(g,E,f){const b=g.append("tspan").attr("x",2*(0,t.g)().state.padding).text(E);f||b.attr("dy",(0,t.g)().state.textHeight)}(p,g,d),d=!1),a=!1});const B=e.append("line").attr("x1",(0,t.g)().state.padding).attr("y1",(0,t.g)().state.padding+l+(0,t.g)().state.dividerMargin/2).attr("y2",(0,t.g)().state.padding+l+(0,t.g)().state.dividerMargin/2).attr("class","descr-divider"),x=p.node().getBBox(),c=Math.max(x.width,s.width);B.attr("x2",c+3*(0,t.g)().state.padding),e.insert("rect",":first-child").attr("x",(0,t.g)().state.padding).attr("y",(0,t.g)().state.padding).attr("width",c+2*(0,t.g)().state.padding).attr("height",x.height+l+2*(0,t.g)().state.padding).attr("rx",(0,t.g)().state.radius)})(s,i);const l=s.node().getBBox();return o.width=l.width+2*(0,t.g)().state.padding,o.height=l.height+2*(0,t.g)().state.padding,((e,i)=>{k[e]=i})(r,o),o};let w,H=0;const N={},et=e=>e?e.length*w.fontSizeFactor:1,R=(e,i,r,o,s,l,p)=>{const a=new T.k({compound:!0,multigraph:!0});let d,B=!0;for(d=0;d<e.length;d++)if("relation"===e[d].stmt){B=!1;break}a.setGraph(r?{rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:B?1:w.edgeLengthFactor,nodeSep:B?1:50,isMultiGraph:!0}:{rankdir:"TB",multigraph:!0,compound:!0,ranksep:B?1:w.edgeLengthFactor,nodeSep:B?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}}),p.db.extract(e);const x=p.db.getStates(),c=p.db.getRelations(),g=Object.keys(x);for(const n of g){const u=x[n];let h;if(r&&(u.parentId=r),u.doc){let y=i.append("g").attr("id",u.id).attr("class","stateGroup");h=R(u.doc,y,u.id,!o,s,l,p);{y=Y(y,u,o);let M=y.node().getBBox();h.width=M.width,h.height=M.height+w.padding/2,N[u.id]={y:w.compositTitleSize}}}else h=C(i,u);if(u.note){const M=C(i,{descriptions:[],id:u.id+"-note",note:u.note,type:"note"});"left of"===u.note.position?(a.setNode(h.id+"-note",M),a.setNode(h.id,h)):(a.setNode(h.id,h),a.setNode(h.id+"-note",M)),a.setParent(h.id,h.id+"-group"),a.setParent(h.id+"-note",h.id+"-group")}else a.setNode(h.id,h)}t.l.debug("Count=",a.nodeCount(),a);let E=0;c.forEach(function(n){E++,t.l.debug("Setting edge",n),a.setEdge(n.id1,n.id2,{relation:n,width:et(n.title),height:w.labelHeight*t.d.getRows(n.title).length,labelpos:"c"},"id"+E)}),(0,W.bK)(a),t.l.debug("Graph after layout",a.nodes());const f=i.node();a.nodes().forEach(function(n){void 0!==n&&void 0!==a.node(n)?(t.l.warn("Node "+n+": "+JSON.stringify(a.node(n))),s.select("#"+f.id+" #"+n).attr("transform","translate("+(a.node(n).x-a.node(n).width/2)+","+(a.node(n).y+(N[n]?N[n].y:0)-a.node(n).height/2)+" )"),s.select("#"+f.id+" #"+n).attr("data-x-shift",a.node(n).x-a.node(n).width/2),l.querySelectorAll("#"+f.id+" #"+n+" .divider").forEach(h=>{const y=h.parentElement;let M=0,L=0;y&&(y.parentElement&&(M=y.parentElement.getBBox().width),L=parseInt(y.getAttribute("data-x-shift"),10),Number.isNaN(L)&&(L=0)),h.setAttribute("x1",0-L+8),h.setAttribute("x2",M-L-8)})):t.l.debug("No Node "+n+": "+JSON.stringify(a.node(n)))});let b=f.getBBox();a.edges().forEach(function(n){void 0!==n&&void 0!==a.edge(n)&&(t.l.debug("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(a.edge(n))),function(e,i,r){i.points=i.points.filter(d=>!Number.isNaN(d.y));const s=i.points,l=(0,S.jvg)().x(function(d){return d.x}).y(function(d){return d.y}).curve(S.$0Z),p=e.append("path").attr("d",l(s)).attr("id","edge"+H).attr("class","transition");let a="";if((0,t.g)().state.arrowMarkerAbsolute&&(a=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,a=a.replace(/\(/g,"\\("),a=a.replace(/\)/g,"\\)")),p.attr("marker-end","url("+a+"#"+function(d){switch(d){case m.d.relationType.AGGREGATION:return"aggregation";case m.d.relationType.EXTENSION:return"extension";case m.d.relationType.COMPOSITION:return"composition";case m.d.relationType.DEPENDENCY:return"dependency"}}(m.d.relationType.DEPENDENCY)+"End)"),void 0!==r.title){const d=e.append("g").attr("class","stateLabel"),{x:B,y:x}=v.u.calcLabelPosition(i.points),c=t.d.getRows(r.title);let g=0;const E=[];let f=0,b=0;for(let u=0;u<=c.length;u++){const h=d.append("text").attr("text-anchor","middle").text(c[u]).attr("x",B).attr("y",x+g),y=h.node().getBBox();f=Math.max(f,y.width),b=Math.min(b,y.x),t.l.info(y.x,B,x+g),0===g&&(g=h.node().getBBox().height,t.l.info("Title height",g,x)),E.push(h)}let P=g*c.length;if(c.length>1){const u=(c.length-1)*g*.5;E.forEach((h,y)=>h.attr("y",x+y*g-u)),P=g*c.length}const n=d.node().getBBox();d.insert("rect",":first-child").attr("class","box").attr("x",B-f/2-(0,t.g)().state.padding/2).attr("y",x-P/2-(0,t.g)().state.padding/2-3.5).attr("width",f+(0,t.g)().state.padding).attr("height",P+(0,t.g)().state.padding),t.l.info(n)}H++}(i,a.edge(n),a.edge(n).relation))}),b=f.getBBox();const P={id:r||"root",label:r||"root",width:0,height:0};return P.width=b.width+2*w.padding,P.height=b.height+2*w.padding,t.l.debug("Doc rendered",P,a),P},it={parser:m.p,db:m.d,renderer:{setConf:function(){},draw:function(e,i,r,o){w=(0,t.g)().state;const s=(0,t.g)().securityLevel;let l;"sandbox"===s&&(l=(0,S.Ys)("#i"+i));const p=(0,S.Ys)("sandbox"===s?l.nodes()[0].contentDocument.body:"body"),a="sandbox"===s?l.nodes()[0].contentDocument:document;t.l.debug("Rendering diagram "+e);const d=p.select(`[id='${i}']`);(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")})(d),new T.k({multigraph:!0,compound:!0,rankdir:"RL"}).setDefaultEdgeLabel(function(){return{}});const x=o.db.getRootDoc();R(x,d,void 0,!1,p,a,o);const c=w.padding,g=d.node().getBBox(),E=g.width+2*c,f=g.height+2*c;(0,z.c)(d,f,1.75*E,w.useMaxWidth),d.attr("viewBox",`${g.x-w.padding}  ${g.y-w.padding} `+E+" "+f)}},styles:m.s,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,m.d.clear()}}}}]);